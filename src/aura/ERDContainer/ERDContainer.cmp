<aura:component>
    <aura:attribute name="currentState" type="String" default="LIST" description="Options: LIST, DETAIL" />
    <aura:attribute name="allObjects" type="Object[]" />
    <aura:attribute name="objects" type="Object[]" />
    <aura:attribute name="diagrams" type="Object[]" />
    <aura:attribute name="selectedDiagram" type="Object" />
    <aura:attribute name="objectToAdd" type="Object" />
    <aura:attribute name="selectedObject" type="Object" />
    <aura:attribute name="showAddGroup" type="Boolean" default="false" />
    <aura:attribute name="newDiagramName" type="String" default="" />
    <aura:attribute name="searchTerm" type="String" default="" />

    <aura:handler name="init" value="{!this}" action="{!c.doInit}" />

    <aura:handler name="onAddGroup" event="tramn:actionEvent" action="{!c.onAddGroup}" />
    <aura:handler name="onRemoveGroup" event="tramn:actionEvent" action="{!c.onRemoveGroup}" />
    <aura:handler name="onAddObject" event="tramn:actionEvent" action="{!c.onAddObject}" />
    <aura:handler name="onObjectAttributesUpdated" event="tramn:actionEvent" action="{!c.onObjectAttributesUpdated}" />
    <aura:handler name="onDragObjectToGroup" event="tramn:actionEvent" action="{!c.onDragObjectToGroup}" />
    <aura:handler name="onEditGroupName" event="tramn:actionEvent" action="{!c.onEditGroupName}" />
    <aura:handler name="onRemoveObject" event="tramn:actionEvent" action="{!c.onTargetPanelRemoveObject}" />
    <aura:handler name="onObjectClicked" event="tramn:actionEvent" action="{!c.onObjectClicked}" />

    <tramn:AppHeader title="GraphVizForce" subTitle="A better schema builder">
        <aura:set attribute="icon">
            <lightning:icon iconName="standard:apps_admin" size="medium"/>
        </aura:set>
        <aura:set attribute="middleSection">
            <aura:if isTrue="{!v.currentState == 'LIST'}">
                <lightning:input type="search" name="inputSearchDiagram" label="Search Diagram Name" value="{!v.searchTerm}" onchange="{!c.onSearchDiagrams}" />
            </aura:if>
            <aura:if isTrue="{!v.currentState == 'DETAIL'}">
                <h2><lightning:button class="slds-button slds-button_neutral" label="Back" onclick="{!c.onBackToList}" />&nbsp;&nbsp;&nbsp;&nbsp;{!v.selectedDiagram.label}</h2>
            </aura:if>
        </aura:set>
        <aura:set attribute="rightSection">
            <aura:if isTrue="{!v.currentState == 'LIST'}">
                <div class="slds-grid slds-grid_vertical-align-end">
                    <lightning:input type="text" label="New Diagram Name" name="newDiagramName" class="slds-p-right_small" value="{!v.newDiagramName}" />
                    <lightning:button class="slds-button slds-button_neutral slds-align-bottom" label="Add" disabled="{!v.newDiagramName.length == 0}" onclick="{!c.onAddDiagram}" />
                </div>
            </aura:if>
            <aura:if isTrue="{!v.currentState == 'DETAIL'}">
                <lightning:button class="slds-button slds-button_neutral" label="Save" onclick="{!c.onSaveDiagram}" />
                <lightning:button class="slds-button slds-button_neutral" label="Clone" onclick="{!c.onCloneDiagram}" />
            </aura:if>
        </aura:set>
    </tramn:AppHeader>

    <div class="slds-p-around_small">
        <div class="{! join(' ', 'flexContainer', v.currentState == 'LIST' ? '' : 'slds-hide')}">
            <ul class="flexList">
                <aura:iteration items="{!v.diagrams}" var="diagram">
                    <aura:if isTrue="{!diagram.visible}">
                        <li class="slds-p-around_small">
                            <tramn:DiagramCard diagram="{!diagram}" onViewDiagram="{!c.gotoDiagramDetail}" onRemoveDiagram="{!c.onRemoveDiagram}" />
                        </li>
                    </aura:if>
                </aura:iteration>
            </ul>
        </div>

        <div class="{! join(' ', 'slds-grid slds-wrap', v.currentState == 'DETAIL' ? '' : 'slds-hide')}">
            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-2">
                <tramn:DiagramConfigurator aura:id="diagramConfigurator" objects="{!v.objects}" selectedObject="{!v.selectedObject}" diagram="{!v.selectedDiagram}" />
            </div>

            <div class="slds-col slds-size_1-of-1 slds-medium-size_1-of-1 slds-large-size_1-of-2 slds-p-around_xx-small">
                <tramn:DiagramViewer />
            </div>
        </div>
    </div>

    <tramn:modal heading="Add to a Group" show="{!v.showAddGroup}">
        <div class="slds-scrollable" style="max-height:320px;">
            <ul class="slds-listbox slds-listbox_horizontal" role="listbox" aria-label="Selected Options:" aria-orientation="horizontal">
                <aura:iteration items="{!v.selectedDiagram.groups}" var="group">
                    <li class="slds-p-around_xx-small">
                        <lightning:button class="slds-button slds-button_neutral" label="{!group.label}" value="{!group.value}" onclick="{!c.onAddObjectToGroupClicked}" />
                    </li>
                </aura:iteration>
            </ul>
        </div>
    </tramn:modal>

</aura:component>