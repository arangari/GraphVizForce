<apex:page controller="ERDGeneratorController">
	<style type="text/css">
        .textInput {width: 100%;}
	    .pbTitle {white-space: nowrap}
	    #titleContainer {margin: 5px 0px;}
	    #generatorTitle {margin-left: 22px; font-size:1.5em;}
	    #workingLabel {
	    	padding-left: 20px;
	    	margin: 0 10px; 
	    	font-size: 1.1em;
	    	background: url("{!$Resource.WorkingImage}") no-repeat;}
    </style>
    
   	<apex:messages />
    
    <apex:form >
    	<apex:pageBlock >
    		<apex:facet name="header">
    			<apex:outputPanel id="title">
    				<div id="titleContainer">
	    				<h2 id="generatorTitle">Diagram: {!currentSetting}</h2>
	    				<apex:actionStatus id="working">
	    					<apex:facet name="start">
	    						<span id="workingLabel">Working..</span>
	    					</apex:facet>
	    				</apex:actionStatus>
    				</div>
    			</apex:outputPanel>
    		</apex:facet>
            <apex:pageBlockSection columns="3">
			    <apex:pageBlock title="Step 1 - ERD Diagram" id="blockSetting">
                	<apex:pageBlockSection >
                		<apex:selectList id="settingPicklist" value="{!selectedSetting}" 
                			size="1" style="width:150px;">
				            <apex:actionSupport event="onchange" action="{!loadSelectedSetting}" rerender="blockGroup,blockSelection,title" status="working" />
				            <apex:selectOptions value="{!settingSelectOptions}"/>
				        </apex:selectList>
				        <apex:panelGroup >
                    	<apex:commandButton id="btnDeleteSetting" value="Delete" 
                    		action="{!deleteSelectedSetting}" rerender="blockSetting,blockGroup,blockSelection,title" 
                    		status="working" style="width:40px;">
                    	</apex:commandButton>
                    	<apex:commandButton id="btnSaveSetting" value="Save" 
                    		action="{!saveSelectedSetting}" rerender="title" 
                    		status="working" style="width:40px;">
                    	</apex:commandButton>
                    	</apex:panelGroup>
                		<apex:outputText value="OR" />
                    	<br />
                		<apex:inputText id="inpSettingName" styleClass="textInput" value="{!newSettingName}" />
                    	<apex:commandButton id="btnSaveNewSetting" value="Save as New" 
                    		action="{!saveAsNewSetting}" rerender="settingPicklist,title" status="working">
                    		<apex:param value="{!newSettingName}"/>
                    	</apex:commandButton>
                	</apex:pageBlockSection>
                </apex:pageBlock>
                <apex:pageBlock title="Step 2 - Groups in Diagram" id="blockGroup">
                	<apex:pageBlockSection >
                    	<apex:inputText id="inpGroupName" styleClass="textInput" value="{!newGroupName}" />
                    	<apex:commandButton id="btnCreateGroup" value="Add" 
                    		action="{!addNewGroupWithInput}" rerender="groupTable" status="working">
                    	</apex:commandButton>
                	</apex:pageBlockSection>
                	<apex:pageBlockTable id="groupTable" value="{!ERDGroupList}" var="group">
				    	<apex:column headerValue="Select Groups">
				        	<apex:inputCheckbox id="groupCheckBox" value="{!group.selected}">
					        	<!-- <apex:actionSupport event="onchange" rerender="selectedGroupPicklist"/> -->
				        	</apex:inputCheckbox>
				    		<apex:outputLabel value="{!group.groupName}" for="groupCheckBox" />
				        </apex:column>
				        <apex:column headerValue="Edit" width="30">
				        	<apex:commandButton id="editGroupButton" value="Edit >>" rerender="blockSelection" status="working">
					        	<apex:param assignTo="{!selectedGroup}" value="{!group.groupName}" name="selectedERDGroup"/>
				        	</apex:commandButton>
				        </apex:column>
				        <apex:column headerValue="Delete" width="30">
				        	<apex:commandButton id="deleteGroupButton" value="Delete" action="{!deleteERDGroup}" rerender="blockGroup,blockSelection" status="working">
				        		<apex:param assignTo="{!groupToDelete}" value="{!group.groupName}" name="ERDGroupToDelete"/>
				        	</apex:commandButton>
				        </apex:column>
				    </apex:pageBlockTable>
                </apex:pageBlock>
                
                <apex:pageBlock title="Step 3 - Edit Group: {!selectedGroup}" id="blockSelection">
		            <apex:panelGrid columns="3">
		            	<apex:panelGroup >
		            		<div style="height:12px;">
		            		<apex:outputText value="Available Objects" />
		            		</div>
		            		<br />
		            		<apex:selectList id="unselected_list" required="false"
			                    value="{!selected}" multiselect="true" size="20" style="width:250px;">
			                    <apex:selectOptions value="{!unSelectedOptions}"/>
			                </apex:selectList>
		            	</apex:panelGroup>
		                <apex:panelGroup >
		                	<br />
		                	<br />
		                	<br />
		                	<br />
		                	<br />
		                    <apex:commandButton value=">>" action="{!DoSelect}" 
		                        reRender="blockSelection" status="working"/>
		                    <br/>
		                    <apex:commandButton value="<<" action="{!DoUnselect}" 
		                        reRender="blockSelection" status="working"/>
		                </apex:panelGroup>
		                <apex:panelGroup >
	                		<div style="height:12px;">
		            		<apex:outputText value="Included Objects" />
		            		</div>
		            		<br />
			                <apex:selectList id="selected_list" required="false"
			                    value="{!unselected}" multiselect="true" size="20" style="width:250px;">
			                    <apex:selectOptions value="{!selectedOptions}"/>
			                </apex:selectList>
		                </apex:panelGroup>
		            </apex:panelGrid>
		        </apex:pageBlock>
            </apex:pageBlockSection>
            <apex:pageBlockSection columns="1">
	            <apex:facet name="header">
			         <span style="color:#000000;">ERD Content</span>
			    </apex:facet>
			    <apex:commandButton value="Generate ERD Content" action="{!generateERD}" rerender="contentTextArea" status="working"/>
                <apex:inputTextarea id="contentTextArea" value="{!generatedContent}" rows="20" style="width:100%;" />
            </apex:pageBlockSection>
        </apex:pageBlock>
    </apex:form>

</apex:page>